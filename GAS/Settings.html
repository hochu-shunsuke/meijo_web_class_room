<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { margin: 10px; }
    </style>
</head>
<body>

    <div class="container-fluid">
        <h4>WebClass èªè¨¼æƒ…å ±ç™»éŒ²</h4>
        <p class="text-muted">å­¦ç±ç•ªå·ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚æƒ…å ±ã¯Googleã®å®‰å…¨ãªé ˜åŸŸã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚</p>
        
        <div id="alert-message" class="alert alert-danger d-none" role="alert"></div>

        <form onsubmit="return handleFormSubmit(this)">
            <div class="mb-3">
                <label for="userid" class="form-label">å­¦ç±ç•ªå· (User ID)</label>
                <input type="text" class="form-control" id="userid" required>
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ (Password)</label>
                <input type="password" class="form-control" id="password" required>
            </div>
            <button id="save-btn" type="submit" class="btn btn-primary w-100">
                è³‡æ ¼æƒ…å ±ã‚’ç™»éŒ²
            </button>
        </form>
    </div>

    <script>
    // ãƒœã‚¿ãƒ³æ“ä½œã®ãŸã‚ã®UIã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã‚’å–å¾—
    const saveButton = document.getElementById('save-btn');
    const alertMessage = document.getElementById('alert-message');

    /**
     * ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã®å‡¦ç†
     */
    function handleFormSubmit() {
        // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã®å–å¾— â˜…ã“ã“ã‚’å¾¹åº•çš„ã«ãƒã‚§ãƒƒã‚¯ï¼
        const userid = document.getElementById('userid').value;
        const password = document.getElementById('password').value;
        
        // å…¥åŠ›å€¤ãŒç©ºã®å ´åˆã¯ã€GASã‚µãƒ¼ãƒãƒ¼ã¸ã®é€ä¿¡ã‚’ã›ãšã«HTMLå´ã§è­¦å‘Šã‚’å‡ºã™ï¼ˆGASå´ã®ã‚¨ãƒ©ãƒ¼ã‚’é˜²ãï¼‰
        if (!userid || !password) {
            onFailure({message: "å­¦ç±ç•ªå·ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ä¸¡æ–¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"});
            return false;
        }

        // UIã‚’æ›´æ–°
        saveButton.disabled = true;
        saveButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> ä¿å­˜ä¸­...';
        alertMessage.classList.add('d-none'); 

        // GASã‚µãƒ¼ãƒãƒ¼å´é–¢æ•° 'setCredentials' ã®å‘¼ã³å‡ºã—
        google.script.run
            .withSuccessHandler(onSuccess)
            .withFailureHandler(onFailure)
            .setCredentials(userid, password);
            
        // ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé€ä¿¡ã‚’é˜²ã (ã“ã‚ŒãŒé‡è¦)
        return false; 
    }

    /**
     * ç™»éŒ²æˆåŠŸæ™‚ã®å‡¦ç†
     */
    function onSuccess() {
        alertMessage.classList.remove('alert-danger');
        alertMessage.classList.add('alert-success');
        alertMessage.textContent = 'âœ… èªè¨¼æƒ…å ±ã‚’æ­£å¸¸ã«ä¿å­˜ã—ã¾ã—ãŸã€‚';
        alertMessage.classList.remove('d-none');
        
        saveButton.disabled = false;
        saveButton.innerHTML = 'è³‡æ ¼æƒ…å ±ã‚’ç™»éŒ²';
    }
    
    /**
     * ç™»éŒ²å¤±æ•—æ™‚ã®å‡¦ç† (ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º)
     */
    function onFailure(error) {
        alertMessage.classList.remove('alert-success');
        alertMessage.classList.add('alert-danger');
        // ä»Šå›ã®ã‚¨ãƒ©ãƒ¼ã®ã‚ˆã†ã«ã€GASå´ã‹ã‚‰é€ã‚‰ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹
        alertMessage.textContent = 'ğŸš¨ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message; 
        alertMessage.classList.remove('d-none');

        saveButton.disabled = false;
        saveButton.innerHTML = 'è³‡æ ¼æƒ…å ±ã‚’ç™»éŒ²';
    }
  </script>
</body>
</html>